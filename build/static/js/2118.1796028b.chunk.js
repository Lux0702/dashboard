"use strict";(self.webpackChunk_coreui_coreui_free_react_admin_template=self.webpackChunk_coreui_coreui_free_react_admin_template||[]).push([[2118],{23924:(e,s,t)=>{t.d(s,{TN:()=>o,p6:()=>a,xG:()=>r});var n=t(34461);const r=e=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),o=e=>new Date(e).toLocaleDateString("en-CA"),a=e=>(0,n.W)(new Date(e),"dd-MM-yyyy")},96692:(e,s,t)=>{t.r(s),t.d(s,{default:()=>x});var n=t(72791),r=t(78983),o=t(24846),a=t(66064),c=t(9085),l=(t(5462),t(23458)),i=t(14701),d=t(23924),h=t(80184);const x=()=>{const[e,s]=(0,n.useState)([]),[t,x]=(0,n.useState)([]),[u,j]=(0,n.useState)([]),[m,g]=(0,n.useState)(null),[p,b]=(0,n.useState)([]),[N,f]=(0,n.useState)(null),[y,T]=(0,n.useState)(null),[k,S]=(0,n.useState)(!1),[v,D]=(0,n.useState)(!1),[E,w]=(0,n.useState)([{status:"PROCESSING",color:"blue"},{status:"DELIVERING",color:"orange"},{status:"DELIVERED",color:"green"},{status:"PENDING",color:"gray"}]);(0,n.useEffect)((()=>{k||f(null)}),[k]),(0,n.useEffect)((()=>{(async()=>{const e=localStorage.getItem("userInfo"),s=JSON.parse(e).data.accessToken;try{const e=await fetch("".concat(l.C,"/admin/dashboard/users"),{method:"GET",headers:{Authorization:"Bearer ".concat(s)}});if(e.ok){const s=await e.json();j(s.data),console.log("get user success")}else console.error("Error fetching users:",e.statusText)}catch(t){console.error("Error fetching users:",t)}})()}),[]),(0,n.useEffect)((()=>{(async()=>{try{const t=await fetch("".concat(l.C,"/books"));if(t.ok){const n=await t.json();s(n.data),console.log("Get data success",e)}else console.error("Error fetching books:",t.statusText)}catch(t){console.error("Error fetching books:",t)}})()}),[]);(0,n.useEffect)((()=>{(async()=>{const e=localStorage.getItem("userInfo"),s=JSON.parse(e).data.accessToken;try{D(!0);const e=await fetch("".concat(l.C,"/orders"),{method:"GET",headers:{Authorization:"Bearer ".concat(s)}});if(e.ok){const s=[...(await e.json()).data].sort(((e,s)=>new Date(s.orderDate)-new Date(e.orderDate)));x(s)}else console.error("Error fetching orders:",e.statusText)}catch(t){console.error("Error fetching orders:",t)}finally{D(!1)}})()}),[]);const O=async(e,s)=>{const t=localStorage.getItem("userInfo"),n=JSON.parse(t).data.accessToken;try{const t=await fetch("".concat(l.C,"/orders/").concat(e,"/status"),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n)},body:JSON.stringify({status:s})});if(t.ok){console.log("Order ".concat(e," status updated to ").concat(s));const n=await t.json();c.Am.success(n.message)}else{console.error("Error updating order status:",t.statusText);const e=await t.json();c.Am.error(e.message)}}catch(r){c.Am.error("Error updating order status:",r)}};return(0,h.jsxs)(r.rb,{children:[(0,h.jsx)(r.b7,{xs:12,children:(0,h.jsxs)(r.xH,{className:"mb-4",children:[(0,h.jsx)(r.bn,{children:(0,h.jsx)("strong",{children:"Danh s\xe1ch \u0111\u01a1n h\xe0ng"})}),(0,h.jsxs)(r.sl,{children:[(0,h.jsxs)(r.Sx,{children:[(0,h.jsx)(r.V,{children:(0,h.jsxs)(r.T6,{children:[(0,h.jsx)(r.is,{scope:"col",children:"*"}),(0,h.jsx)(r.is,{scope:"col",children:"#"}),(0,h.jsx)(r.is,{scope:"col",children:"T\xean ng\u01b0\u1eddi nh\u1eadn"}),(0,h.jsx)(r.is,{scope:"col",children:"S\u1ed1 \u0111i\u1ec7n tho\u1ea1i"}),(0,h.jsx)(r.is,{scope:"col",children:"\u0110\u1ecba ch\u1ec9"}),(0,h.jsx)(r.is,{scope:"col",children:"Ng\xe0y \u0111\u1eb7t h\xe0ng"}),(0,h.jsx)(r.is,{scope:"col",children:"T\u1ed5ng ti\u1ec1n"}),(0,h.jsx)(r.is,{scope:"col",children:"Tr\u1ea1ng th\xe1i"})]})}),(0,h.jsx)(r.NR,{children:t.map(((s,n)=>{var c;return(0,h.jsxs)(r.T6,{active:N===s._id,onClick:e=>{var t;t=s._id,f(t),console.log(t)},children:[(0,h.jsx)(r.NN,{children:(0,h.jsx)(o.Z,{icon:a.A,size:"xl",onClick:()=>(async s=>{console.log(s);try{const t=localStorage.getItem("userInfo"),n=JSON.parse(t).data.accessToken;console.log("id v\xe0 token:",s,n);const r=await fetch("".concat(l.C,"/orders/").concat(s),{method:"GET",headers:{Authorization:"Bearer ".concat(n)}});if(r.ok){const s=await r.json();T(s.data);const t=u.find((e=>e.userId===y.user)),n=y.orderItems.map((s=>e.find((e=>e._id===s.book))));console.log(y),g(t),b(n),console.log(p),S(!0),console.log("get detail success")}else console.error("l\u1ea5y d\u1eef li\u1ec7u th\u1ea5y b\u1ea1i:",r.statusText)}catch(t){console.error("L\u1ed7i k\u1ebft n\u1ed1i:",t)}})(N)})}),(0,h.jsx)(r.is,{scope:"row",children:n+1}),(0,h.jsx)(r.NN,{children:s.fullName}),(0,h.jsx)(r.NN,{children:s.phone}),(0,h.jsx)(r.NN,{children:s.address}),(0,h.jsx)(r.NN,{children:(0,d.p6)(s.orderDate)}),(0,h.jsx)(r.NN,{children:(0,d.xG)(s.totalAmount)||0}),(0,h.jsx)(r.NN,{children:(0,h.jsxs)(r.w5,{variant:"btn-group",style:{borderRadius:"12px"},children:[(0,h.jsx)(r.SQ,{style:{backgroundColor:null===(c=E.find((e=>e.status===s.status)))||void 0===c?void 0:c.color,color:"white",border:"none",borderRadius:"20px"},children:s.status}),(0,h.jsx)(r.$H,{style:{borderRadius:"12px"},children:E.map(((e,s)=>(0,h.jsx)(r.$f,{style:{borderRadius:"12px"},onClick:()=>(e=>{const s=t.map((s=>s._id===N?{...s,status:e}:s));x(s),O(N,e)})(e.status),children:e.status},s)))})]})})]},n)}))})]}),(0,h.jsxs)(r.Tk,{size:"lg",alignment:"center",visible:k,onClose:()=>{S(!1)},children:[(0,h.jsx)(r.p0,{closeButton:!0,children:(0,h.jsxs)(r.fl,{children:["Chi ti\u1ebft \u0111\u01a1n h\xe0ng ",(0,h.jsx)("br",{}),(0,h.jsx)(r.C_,{color:"info",children:(0,h.jsx)("small",{style:{fontSize:"10px"},children:(0,h.jsx)("em",{children:y&&("NOT_PAID"===y.paymentStatus?"Ch\u01b0a thanh to\xe1n":"\u0110\xe3 thanh to\xe1n")})})})]})}),(0,h.jsx)(r.sD,{children:y&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)("p",{children:["T\xean ng\u01b0\u1eddi \u0111\u1eb7t h\xe0ng:",(0,h.jsx)(r.jO,{"aria-label":"T\u1ef1a \u0111\u1ec1",disabled:!0,value:m?m.fullName:""})]}),(0,h.jsx)("div",{className:"mb-3",children:(0,h.jsxs)(r.rb,{children:[(0,h.jsxs)(r.b7,{xs:"6",className:"mb-3",children:[(0,h.jsx)(r.L8,{htmlFor:"totalAmount",children:"T\u1ed5ng \u0111\u01a1n h\xe0ng:"}),(0,h.jsxs)(r.YR,{className:"mb-3",children:[(0,h.jsx)(r.jO,{disabled:!0,type:"text",id:"totalAmount",name:"totalAmount",value:(0,d.xG)(y.totalAmount)||""}),(0,h.jsx)(r.wV,{children:"VN\u0110"})]})]}),(0,h.jsxs)(r.b7,{xs:"6",className:"mb-3",children:[(0,h.jsx)(r.L8,{htmlFor:"orderDate",children:"Ng\xe0y \u0111\u1eb7t h\xe0ng"}),(0,h.jsx)(r.jO,{disabled:!0,type:"date",id:"orderDate",name:"orderDate",value:(0,d.TN)(y.orderDate)})]})]})}),(0,h.jsx)("div",{className:"mb-3",children:(0,h.jsxs)(r.rb,{children:[(0,h.jsxs)(r.b7,{xs:"6",className:"mb-3",children:[(0,h.jsx)(r.L8,{htmlFor:"status",children:"Tr\u1ea1ng th\xe1i:"}),(0,h.jsx)(r.jO,{disabled:!0,type:"text",id:"status",name:"status",value:y.status||""})]}),(0,h.jsxs)(r.b7,{xs:"6",className:"mb-3",children:[(0,h.jsx)(r.L8,{htmlFor:"phone",children:"S\u1ed1 \u0111i\u1ec7n tho\u1ea1i ng\u01b0\u1eddi nh\u1eadn"}),(0,h.jsx)(r.jO,{disabled:!0,type:"text",id:"phone",name:"phone",value:y.phone||0})]})]})}),(0,h.jsx)("div",{className:"mb-3",children:(0,h.jsxs)(r.rb,{children:[(0,h.jsxs)(r.b7,{xs:"6",className:"mb-3",children:[(0,h.jsx)(r.L8,{htmlFor:"fullName",children:"T\xean ng\u01b0\u1eddi nh\u1eadn:"}),(0,h.jsx)(r.jO,{disabled:!0,type:"text",id:"fullName",name:"fullName",placeholder:"Nh\u1eadp gi\xe1 ti\u1ec1n",value:y.fullName})]}),(0,h.jsxs)(r.b7,{xs:"6",className:"mb-3",children:[(0,h.jsx)(r.L8,{htmlFor:"address",children:"\u0110\u1ecba ch\u1ec9 nh\u1eadn h\xe0ng:"}),(0,h.jsx)(r.jO,{disabled:!0,type:"text",id:"address",name:"address",value:y.address})]}),(0,h.jsxs)(r.b7,{xs:"6",className:"mb-3",children:[(0,h.jsx)(r.L8,{htmlFor:"paymentMethod",children:"Ph\u01b0\u01a1ng th\u1ee9c thanh to\xe1n"}),(0,h.jsx)(r.jO,{disabled:!0,type:"text",id:"paymentMethod",name:"paymentMethod",value:("ON_DELIVERY"===y.paymentMethod?"Thanh to\xe1n khi nh\u1eadn h\xe0ng - COD":"Thanh to\xe1n online")||0})]})]})}),(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{children:"C\xe1c m\u1eb7t h\xe0ng:"}),(0,h.jsx)(r.uz,{flush:!0,children:y&&y.orderItems&&y.orderItems.map(((e,s)=>(0,h.jsxs)(r.Ob,{children:[(0,h.jsxs)(r.Lv,{children:[s+1,". ",e.book.title]}),(0,h.jsxs)(r.qI,{children:[(0,h.jsxs)("p",{children:[(0,h.jsx)("strong",{children:"M\xe3 s\u1ea3n ph\u1ea9m:"})," ",e.book._id]}),(0,h.jsxs)("p",{children:[(0,h.jsx)("strong",{children:"S\u1ed1 l\u01b0\u1ee3ng:"})," ",e.quantity]}),(0,h.jsxs)("p",{children:[(0,h.jsx)("strong",{children:"Gi\xe1 ti\u1ec1n:"})," ",(0,d.xG)(e.book.price)||0]}),(0,h.jsxs)("p",{children:[(0,h.jsx)("strong",{children:"Th\xe0nh ti\u1ec1n:"})," ",(0,d.xG)(e.book.price*e.quantity)||0]})]})]},s)))})]})]})})]})]})]})}),(0,h.jsx)(c.Ix,{position:"top-right",autoClose:3e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"light"}),(0,h.jsx)(i.Z,{spinning:v,fullscreen:!0})]})}}}]);
//# sourceMappingURL=2118.1796028b.chunk.js.map